require(['gitbook', 'jQuery'], function(gitbook, $) {

    var wechatURL;
    var titleText;
    var buttonText;
    var wechatText;

    function insertDonateLink() {
        if ($('.gitbook-donate').length === 0 && wechatURL !== undefined) {
            var html = [
                '<div class="gitbook-donate">',
                '<div>' + titleText + '</div>',
                '<button id="rewardButton" disable="enable" onclick="var qr = document.getElementById(\'QR\'); if (qr.style.display === \'none\') {qr.style.display=\'block\';} else {qr.style.display=\'none\'}">',
                '<span>' + buttonText + '</span>',
                '</button>',
                '<div id="QR" style="display: none;">'
            ];
            if (wechatURL !== '') {
                html = html.concat([
                    '<div id="wechat" style="display: inline-block">',
                    '<a href="' + wechatURL + '" class="fancybox" rel="group">',
                    '<img id="wechat_qr" src="' + wechatURL + '" alt="WeChat Pay"/>',
                    '</a>',
                    '<p>' + wechatText + '</p>',
                    '</div>'
                ]);
            }
            html = html.concat(['</div>', '</div>']);
            $('.faq-page-container').after(html.join(''));
        }
    }
    gitbook.events.bind('start', function(e, config) {
        wechatURL = config.donate.wechat || '';
        wechatText = config.donate.wechatText || '微信捐赠';
        titleText = config.donate.title || '';
        buttonText = config.donate.button || '赏';
        insertDonateLink();
    });

    gitbook.events.bind('page.change', function () {

    });

});